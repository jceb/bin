#!/bin/sh
# open files in a vim server

set -e
set -u

GLOBAL=
if [ "$(basename "$0")" = "gserver" ]; then
	GLOBAL="-g"
fi

# enforce editor to make it work better with tmux and ranger
if [ -n "${GLOBAL}" ]; then
	EDITOR="${REALEDITOR:=/usr/bin/gvim}"
else
	EDITOR="${REALEDITOR:=/usr/bin/vim}"
fi

# strip file separator to prevent it from being interpreted as a file
if [ $# -ge 1 ] && [ "${1}" = "--" ]; then
	shift
fi

if [ $# -ge 1 ] && ([ "$1" = '--help' ] || [ "$1" = '-h' ] || [ "$1" = '--serverlist' ]); then
	exec "${EDITOR}" "$@"
elif [ $# -ge 1 ] && [ "$1" = "-" ]; then
	exec "${EDITOR}" --servername "$(vsession "${GLOBAL}")" "$@"
elif [ $# -ge 1 ]; then
	exec "${EDITOR}" --servername "$(vsession "${GLOBAL}")" --remote-silent "$@"
else
	exec "${EDITOR}" --servername "$(vsession "${GLOBAL}")"
fi
